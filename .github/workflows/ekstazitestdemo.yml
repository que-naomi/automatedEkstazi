name: Automate Pom.xml Changes and Test with Ekstazi

on:
  push:
    branches:
      - main

jobs:
  automate_changes_and_test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Java
        uses: actions/setup-java@v2
        with:
          distribution: 'adopt'
          java-version: '11'

      - name: Generate, Update Pom.xml, and Test Projects with Ekstazi
        run: |
          # Loop through the list of projects (adjust these values accordingly)
          projects=(
            #"org.easyb easyb 0.7"
            #"edu.vt.middleware vt-ldap 3.3.1"
            "org.apache.camel camel-csv 2.9.8"
            # Add more projects as needed
          )

          # Compile the Java program
          javac src/main/java/com/example/PomFileUpdater.java

          for project in "${projects[@]}"; do
            IFS=' ' read -ra project_info <<< "$project"
            group_id="${project_info[0]}"
            artifact_id="${project_info[1]}"
            version="${project_info[2]}"

            # Create project
            mvn archetype:generate -DgroupId="$group_id" -DartifactId="$artifact_id" -Dversion="$version" -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false

            # Run Java program to update pom.xml
            java -cp src/main/java/com/example/PomFileUpdater "$artifact_id" "$group_id" "$artifact_id" "$version"

            # Test with Ekstazi
            cd "$artifact_id"
            mvn ekstazi:ekstazi
            cd ..
          done
